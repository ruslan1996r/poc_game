## üß© –°–µ—Ä–≤–µ—Ä (server.cpp)

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:

- –ü–æ–ª—É—á–∞–µ—Ç `Packet{sessionId, id, data}`
- –•—Ä–∞–Ω–∏—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö `id` –æ—Ç–¥–µ–ª—å–Ω–æ –ø–æ –∫–∞–∂–¥–æ–π —Å–µ—Å—Å–∏–∏ (`receivedIds[sessionId]`)
- –ö–∞–∂–¥—ã–µ N –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥ (tick) –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
  - –µ—Å–ª–∏ –Ω–∞–∫–æ–ø–∏–ª–æ—Å—å WINDOW_SIZE –ø–∞–∫–µ—Ç–æ–≤
  - –∏–ª–∏ –µ—Å–ª–∏ –∏—Å—Ç—ë–∫ —Ç–∞–π–º–µ—Ä –æ–∂–∏–¥–∞–Ω–∏—è (`ACK_TIMEOUT_MS`)
- –§–æ—Ä–º–∏—Ä—É–µ—Ç Batch ACK:
  - –£–∫–∞–∑—ã–≤–∞–µ—Ç `firstPacketId = lastAckedId + 1`
  - –§–æ—Ä–º–∏—Ä—É–µ—Ç `receivedMask` –¥–ª–∏–Ω–æ–π WINDOW_SIZE
  - –ü—Ä–∏–º–µ—Ä:
    - `firstPacketId = 6`
    - –ø–æ–ª—É—á–µ–Ω–æ: `6, 7, 9`
    - ‚Üí mask = `11001`
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç ACK –∫–ª–∏–µ–Ω—Ç—É
- –ü—Ä–æ–¥–≤–∏–≥–∞–µ—Ç `lastAckedId` **—Ç–æ–ª—å–∫–æ –ø–æ –ø–æ–¥—Ä—è–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–º ID** (—Ç–æ –µ—Å—Ç—å –±–µ–∑ –¥—ã—Ä)

### –ß—Ç–æ —Ç–∞–∫–æ–µ "—Å–¥–≤–∏–≥ –æ–∫–Ω–∞" (`lastAckedId`):

- –≠—Ç–æ ID –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ **–Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ** –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–∞
- –°–µ—Ä–≤–µ—Ä –¥–≤–∏–≥–∞–µ—Ç `lastAckedId`, –ø–æ–∫–∞ –±–∏—Ç –≤ `mask[i]` = 1
- –ï—Å–ª–∏ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç `0` (–ø–∞–∫–µ—Ç –Ω–µ –ø–æ–ª—É—á–µ–Ω) ‚Äî **–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ**
- –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –∫–ª–∏–µ–Ω—Ç –±—É–¥–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ –ø—Ä–∏—Å—ã–ª–∞—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ ID

### –ü–æ—á–µ–º—É –Ω–µ–ª—å–∑—è –ø—Ä–æ—Å—Ç–æ –¥–µ–ª–∞—Ç—å `lastAckedId += WINDOW_SIZE`:

- –≠—Ç–æ –±—ã –Ω–∞—Ä—É—à–∏–ª–æ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å
- ACK –±—ã –ø–µ—Ä–µ—Å–∫–æ—á–∏–ª —á–µ—Ä–µ–∑ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã
- –ö–ª–∏–µ–Ω—Ç —Å—á—ë–ª –±—ã –∏—Ö –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º–∏, —Ö–æ—Ç—è —ç—Ç–æ –Ω–µ —Ç–∞–∫

---

## üõ° –ü—Ä–∏–º–µ—Ä:

–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —à–ª—ë—Ç `1‚Äì10`, –Ω–æ —Å–µ—Ä–≤–µ—Ä –ø–æ–ª—É—á–∏–ª —Ç–æ–ª—å–∫–æ:
- `1‚Äì5` ‚Üí ACK c ID 1, mask: `11111`
- `6, 7, 9, 10` ‚Üí ACK c ID 6, mask: `11001`
- –ü–æ–∑–∂–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç `8` ‚Üí ACK c ID 6, mask: `11111`

---

## ‚öô –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

| –ü–∞—Ä–∞–º–µ—Ç—Ä          | –ì–¥–µ          | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ                            |
|-------------------|---------------|------------------------|-------------------------------------|
| `WINDOW_SIZE`     | client/server | 5                      | –†–∞–∑–º–µ—Ä –±–∏—Ç–æ–≤–æ–π –º–∞—Å–∫–∏ ACK            |
| `ACK_TIMEOUT_MS`  | server        | 100                    | –¢–∞–π–º–∞—É—Ç –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π ACK         |
| `BASE_TIMEOUT_MS` | client        | 200                    | –¢–∞–π–º–∞—É—Ç –¥–æ –ø–µ—Ä–≤–æ–π —Ä–µ—Ç—Ä–∞–∏            |
| `EXTENDED_TIMEOUT_MS` | client    | 500                    | –¢–∞–π–º–∞—É—Ç –ø–æ—Å–ª–µ 3-–π –ø–æ–ø—ã—Ç–∫–∏           |
| `MAX_RETRIES`     | client        | 5                      | –ú–∞–∫—Å–∏–º—É–º –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –æ—Ç–ø—Ä–∞–≤–æ–∫         |
| `TICK_RATE`       | server        | 60                     | –ö–æ–ª-–≤–æ —Ç–∏–∫–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É              |

---

## üì¶ –í—ã–≤–æ–¥

–¢—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª:

- –ù–∞–¥—ë–∂–Ω—É—é –¥–æ—Å—Ç–∞–≤–∫—É –ø–æ–≤–µ—Ä—Ö UDP
- –ü—Ä–æ—Ç–æ–∫–æ–ª —Å ACK –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∏—Ç–æ–≤–æ–π –º–∞—Å–∫–∏
- sessionId-–ø–æ–¥–¥–µ—Ä–∂–∫—É
- –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ä–µ—Ç—Ä–∞–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –æ–∫–Ω–∞

–¢–µ–ø–µ—Ä—å –≥–æ—Ç–æ–≤ –¥–≤–∏–≥–∞—Ç—å—Å—è –¥–∞–ª—å—à–µ: `MOVE`, `SHOOT`, `GameState`, delta updates ‚Äî –∏ —Ç—ã —É–∂–µ –±–ª–∏–∑–∫–æ –∫ –Ω–∞—Å—Ç–æ—è—â–µ–π –∏–≥—Ä–æ–≤–æ–π —Å–µ—Ç–µ–≤–æ–π –ª–æ–≥–∏–∫–µ üöÄ